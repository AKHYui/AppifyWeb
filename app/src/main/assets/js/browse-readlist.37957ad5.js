"use strict";(self["webpackChunkkomga_webui"]=self["webpackChunkkomga_webui"]||[]).push([[3238],{95845:function(e,t,s){s.r(t),s.d(t,{default:function(){return N}});var i=s(73847),a=s(15137),o=s(1231),r=s(70793),l=s(39975),n=s(16684),d=s(6231),h=s(22369),c=s(80700),u=s(40005),m=s(26702),p=s(84551),g=function(){var e=this,t=e._self._c;e._self._setupProxy;return e.readList?t("div",[e.editElements||0!==e.selectedBooks.length?e._e():t("toolbar-sticky",[e.readList?t("read-list-actions-menu",{attrs:{"read-list":e.readList}}):e._e(),e.readList?t(m.sw,[t("span",[e._v(e._s(e.readList.name))]),t(a.A,{staticClass:"mx-4",attrs:{label:""}},[t("span",{staticStyle:{"font-size":"1.1rem"}},[e._v(e._s(e.totalElements))])]),e.readList.ordered?t("span",{staticClass:"font-italic text-overline"},[e._v("("+e._s(e.$t("browse_readlist.manual_ordering"))+")")]):e._e()],1):e._e(),t(u.A),e.isAdmin?t(i.A,{attrs:{icon:""},on:{click:e.startEditElements}},[t(p.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(n.A,e._g({},s),[e._v("mdi-playlist-edit")])]}}],null,!1,1014130452)},[t("span",[e._v(e._s(e.$t("browse_readlist.edit_elements")))])])],1):e._e(),e.isAdmin?t(i.A,{attrs:{icon:""},on:{click:e.editReadList}},[t(p.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(n.A,e._g({},s),[e._v("mdi-pencil")])]}}],null,!1,1783139550)},[t("span",[e._v(e._s(e.$t("browse_readlist.edit_readlist")))])])],1):e._e(),t("page-size-select",{model:{value:e.pageSize,callback:function(t){e.pageSize=t},expression:"pageSize"}}),t(i.A,{attrs:{icon:""},on:{click:function(t){e.drawer=!e.drawer}}},[t(n.A,{attrs:{color:e.filterActive?"secondary":""}},[e._v("mdi-filter-variant")])],1)],1),t("multi-select-bar",{attrs:{kind:"books",oneshots:e.selectedOneshots,"show-select-all":""},on:{"unselect-all":function(t){e.selectedBooks=[]},"select-all":function(t){e.selectedBooks=e.books},"mark-read":e.markSelectedRead,"mark-unread":e.markSelectedUnread,"add-to-collection":e.addToCollection,"add-to-readlist":e.addToReadList,edit:e.editMultipleBooks,"bulk-edit":e.bulkEditMultipleBooks,delete:e.deleteBooks},model:{value:e.selectedBooks,callback:function(t){e.selectedBooks=t},expression:"selectedBooks"}}),t(c.Yt,{attrs:{"hide-on-leave":""}},[e.editElements?t("toolbar-sticky",{attrs:{elevation:5,color:"base"}},[t(i.A,{attrs:{icon:""},on:{click:e.cancelEditElements}},[t(n.A,[e._v("mdi-close")])],1),t(i.A,{attrs:{icon:"",color:"primary",disabled:0===e.books.length},on:{click:e.doEditElements}},[t(n.A,[e._v("mdi-check")])],1)],1):e._e()],1),t("filter-drawer",{attrs:{"clear-button":e.filterActive},on:{clear:e.resetFilters},scopedSlots:e._u([{key:"default",fn:function(){return[t("filter-list",{attrs:{"filters-options":e.filterOptionsList,"filters-active":e.filters},on:{"update:filtersActive":function(t){e.filters=t},"update:filters-active":function(t){e.filters=t}}})]},proxy:!0},{key:"filter",fn:function(){return[t("filter-panels",{attrs:{"filters-options":e.filterOptionsPanel,"filters-active":e.filters},on:{"update:filtersActive":function(t){e.filters=t},"update:filters-active":function(t){e.filters=t}}})]},proxy:!0}],null,!1,457844017),model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}}),t(r.A,{attrs:{fluid:""}},[e.readList.summary?t(h.A,{staticClass:"px-2"},[t(o.A,[t("read-more",[e._v(e._s(e.readList.summary))])],1)],1):e._e(),t(h.A,{staticClass:"px-2"},[t(o.A,[t(i.A,{attrs:{title:e.$t("menu.download_readlist"),small:"",disabled:!e.canDownload,href:e.fileUrl}},[t(n.A,{attrs:{left:"",small:""}},[e._v("mdi-file-download")]),e._v(" "+e._s(e.$t("common.download"))+" ")],1)],1)],1),t(l.A,{staticClass:"my-3"}),0===e.totalPages?t("empty-state",{attrs:{title:e.$t("common.filter_no_matches"),"sub-title":e.$t("common.use_filter_panel_to_change_filter"),icon:"mdi-book-multiple","icon-color":"secondary"}},[t(i.A,{on:{click:e.resetFilters}},[e._v(e._s(e.$t("common.reset_filters")))])],1):[e.totalPages>1?t(d.A,{attrs:{"total-visible":e.paginationVisible,length:e.totalPages},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e(),t("item-browser",{attrs:{items:e.books,"item-context":e.itemContext,selected:e.selectedBooks,"edit-function":e.isAdmin?e.editSingleBook:void 0,draggable:e.editElements&&e.readList.ordered,deletable:e.editElements},on:{"update:items":function(t){e.books=t},"update:selected":function(t){e.selectedBooks=t}}}),e.totalPages>1?t(d.A,{attrs:{"total-visible":e.paginationVisible,length:e.totalPages},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e()]],2)],1):e._e()},f=[],v=(s(62554),s(28743),s(14602),s(10734)),y=s(72448),k=s(52846),b=s(85471),$=s(51186),w=s(78892),L=s(13044),S=s(2543),A=s(4291),_=s(49865),E=s(97782),B=s(85894),R=s(79957),P=s(41272),I=s(71933),C=s(33513),O=s(54919),x=s(4395),z=s(1324),U=b.Ay.extend({name:"BrowseReadList",components:{EmptyState:z.A,PageSizeSelect:x.A,ToolbarSticky:y.A,ItemBrowser:v.A,ReadListActionsMenu:$.A,MultiSelectBar:w.A,FilterDrawer:_.A,FilterPanels:E.A,FilterList:B.A,ReadMore:A.A},data:()=>({ItemContext:O.XZ,readList:void 0,books:[],booksCopy:[],selectedBooks:[],page:1,pageSize:20,unpaged:!1,totalPages:1,totalElements:null,editElements:!1,filters:{},filterUnwatch:null,pageUnwatch:null,pageSizeUnwatch:null,drawer:!1,filterOptions:{library:[],tag:[]}}),props:{readListId:{type:String,required:!0}},created(){this.$eventHub.$on(k._X,this.readListChanged),this.$eventHub.$on(k.Vp,this.readListDeleted),this.$eventHub.$on(k.vk,this.bookChanged),this.$eventHub.$on(k.Qg,this.bookChanged),this.$eventHub.$on(k.pU,this.readProgressChanged),this.$eventHub.$on(k.Ih,this.readProgressChanged)},beforeDestroy(){this.$eventHub.$off(k._X,this.readListChanged),this.$eventHub.$off(k.Vp,this.readListDeleted),this.$eventHub.$off(k.vk,this.bookChanged),this.$eventHub.$off(k.Qg,this.bookChanged),this.$eventHub.$off(k.pU,this.readProgressChanged),this.$eventHub.$off(k.Ih,this.readProgressChanged)},async mounted(){this.pageSize=this.$store.state.persistedState.browsingPageSize||this.pageSize,await this.resetParams(this.$route,this.readListId),this.$route.query.page&&(this.page=Number(this.$route.query.page)),this.$route.query.pageSize&&(this.pageSize=Number(this.$route.query.pageSize)),this.loadReadList(this.readListId),this.setWatches()},async beforeRouteUpdate(e,t,s){e.params.readListId!==t.params.readListId&&(this.unsetWatches(),await this.resetParams(this.$route,this.readListId),this.page=1,this.totalPages=1,this.totalElements=null,this.books=[],this.editElements=!1,this.loadReadList(e.params.readListId),this.setWatches()),s()},computed:{itemContext(){var e;return!1===(null===(e=this.readList)||void 0===e?void 0:e.ordered)?[O.XZ.SHOW_SERIES,O.XZ.RELEASE_DATE]:[O.XZ.SHOW_SERIES]},paginationVisible(){switch(this.$vuetify.breakpoint.name){case"xs":return 5;case"sm":case"md":return 10;case"lg":case"xl":default:return 15}},filterOptionsList(){return{readStatus:{values:[{name:this.$i18n.t("filter.unread").toString(),value:R.RJ.UNREAD},{name:this.$t("filter.in_progress").toString(),value:R.RJ.IN_PROGRESS},{name:this.$t("filter.read").toString(),value:R.RJ.READ}]}}},filterOptionsPanel(){const e={library:{name:this.$t("filter.library").toString(),values:this.filterOptions.library},tag:{name:this.$t("filter.tag").toString(),values:this.filterOptions.tag}};return P.B.forEach((t=>{e[t]={name:this.$t(`author_roles.${t}`).toString(),search:async e=>(await this.$komgaReferential.getAuthors(e,t,void 0,void 0,void 0,this.readListId)).content.map((e=>e.name))}})),e},isAdmin(){return this.$store.getters.meAdmin},canDownload(){return this.$store.getters.meFileDownload},fileUrl(){return(0,C.sT)(this.readListId)},filterActive(){return Object.keys(this.filters).some((e=>0!==this.filters[e].length))},selectedOneshots(){return this.selectedBooks.every((e=>e.oneshot))}},methods:{resetFilters(){this.drawer=!1;for(const e in this.filters)this.$set(this.filters,e,[]);this.$store.commit("setReadListFilter",{id:this.readListId,filter:this.filters}),this.updateRouteAndReload()},async resetParams(e,t){this.$set(this.filterOptions,"library",this.$store.state.komgaLibraries.libraries.map((e=>({name:e.name,value:e.id}))));const s=await this.$komgaReferential.getBookTags(void 0,t);let i;this.$set(this.filterOptions,"tag",(0,I.Un)(s)),e.query.readStatus||e.query.tag||e.query.library||P.B.some((t=>t in e.query))?(i={readStatus:e.query.readStatus||[],library:e.query.library||[],tag:e.query.tag||[]},P.B.forEach((t=>{i[t]=e.query[t]||[]}))):i=this.$store.getters.getReadListFilter(e.params.readListId)||{},this.filters=this.validateFilters(i)},validateFilters(e){var t,s,i;const a={readStatus:(null===(t=e.readStatus)||void 0===t?void 0:t.filter((e=>Object.keys(R.RJ).includes(e))))||[],library:(null===(s=e.library)||void 0===s?void 0:s.filter((e=>this.filterOptions.library.map((e=>e.value)).includes(e))))||[],tag:(null===(i=e.tag)||void 0===i?void 0:i.filter((e=>this.filterOptions.tag.map((e=>e.value)).includes(e))))||[]};return P.B.forEach((t=>{a[t]=e[t]||[]})),a},setWatches(){this.filterUnwatch=this.$watch("filters",(e=>{this.$store.commit("setReadListFilter",{id:this.readListId,filter:e}),this.updateRouteAndReload()})),this.pageSizeUnwatch=this.$watch("pageSize",(e=>{this.$store.commit("setBrowsingPageSize",e),this.updateRouteAndReload()})),this.pageUnwatch=this.$watch("page",(e=>{this.updateRoute(),this.loadPage(this.readListId,e)}))},unsetWatches(){this.filterUnwatch(),this.pageUnwatch(),this.pageSizeUnwatch()},updateRouteAndReload(){this.unsetWatches(),this.page=1,this.updateRoute(),this.loadPage(this.readListId,this.page),this.setWatches()},updateRoute(){const e={name:this.$route.name,params:{readListId:this.$route.params.readListId},query:{page:`${this.page}`,pageSize:`${this.pageSize}`}};(0,I.Bp)(this.filters,e.query),this.$router.replace(e).catch((e=>{}))},readListChanged(e){e.readListId===this.readListId&&this.loadReadList(this.readListId)},readListDeleted(e){e.readListId===this.readListId&&this.$router.push({name:"browse-readlists",params:{libraryId:"all"}})},async loadReadList(e){this.$komgaReadLists.getOneReadList(e).then((e=>{this.readList=e,document.title=`Komga - ${e.name}`})),await this.loadPage(e,this.page)},async loadPage(e,t){this.selectedBooks=[];const s={page:t-1,size:this.pageSize,unpaged:this.unpaged};let i=[];P.B.forEach((e=>{e in this.filters&&this.filters[e].forEach((t=>i.push({name:t,role:e})))}));const a=await this.$komgaReadLists.getBooks(e,s,this.filters.library,this.filters.readStatus,this.filters.tag,i);this.totalPages=a.totalPages,this.totalElements=a.totalElements,this.books=a.content,this.books.forEach((t=>t.context={origin:L.E.READLIST,id:e})),this.booksCopy=[...this.books],this.selectedBooks=[]},reloadPage:(0,S.throttle)((function(){this.loadPage(this.readListId,this.page)}),1e3),async editSingleBook(e){if(e.oneshot){const t=await this.$komgaSeries.getOneSeries(e.seriesId);this.$store.dispatch("dialogUpdateOneshots",{series:t,book:e})}else this.$store.dispatch("dialogUpdateBooks",e)},async editMultipleBooks(){if(this.selectedBooks.every((e=>e.oneshot))){const e=await Promise.all(this.selectedBooks.map((e=>this.$komgaSeries.getOneSeries(e.seriesId)))),t=this.selectedBooks.map(((t,s)=>({series:e[s],book:t})));this.$store.dispatch("dialogUpdateOneshots",t)}else this.$store.dispatch("dialogUpdateBooks",this.selectedBooks)},bulkEditMultipleBooks(){this.$store.dispatch("dialogUpdateBulkBooks",this.selectedBooks)},deleteBooks(){this.$store.dispatch("dialogDeleteBook",this.selectedBooks)},async markSelectedRead(){await Promise.all(this.selectedBooks.map((e=>this.$komgaBooks.updateReadProgress(e.id,{completed:!0})))),this.selectedBooks=[]},async markSelectedUnread(){await Promise.all(this.selectedBooks.map((e=>this.$komgaBooks.deleteReadProgress(e.id)))),this.selectedBooks=[]},addToCollection(){this.$store.dispatch("dialogAddSeriesToCollection",this.selectedBooks.map((e=>e.seriesId)))},addToReadList(){this.$store.dispatch("dialogAddBooksToReadList",this.selectedBooks.map((e=>e.id)))},async startEditElements(){this.filters={},this.unpaged=!0,await this.reloadPage(),this.editElements=!0},cancelEditElements(){this.editElements=!1,this.books=[...this.booksCopy],this.unpaged=!1,this.reloadPage()},doEditElements(){this.editElements=!1;const e={bookIds:this.books.map((e=>e.id))};this.$komgaReadLists.patchReadList(this.readListId,e),this.unpaged=!1,this.reloadPage()},editReadList(){this.$store.dispatch("dialogEditReadList",this.readList)},bookChanged(e){this.books.some((t=>t.id===e.bookId))&&this.reloadPage()},readProgressChanged(e){this.books.some((t=>t.id===e.bookId))&&this.reloadPage()}}}),T=U,D=s(81656),H=(0,D.A)(T,g,f,!1,null,null,null),N=H.exports},90826:function(e,t,s){s.d(t,{A:function(){return l}});var i=s(32240),a=i.A,o=s(69463),r=s(85471),l=r.Ay.extend().extend({name:"overlayable",props:{hideOverlay:Boolean,overlayColor:String,overlayOpacity:[Number,String]},data(){return{animationFrame:0,overlay:null}},watch:{hideOverlay(e){this.isActive&&(e?this.removeOverlay():this.genOverlay())}},beforeDestroy(){this.removeOverlay()},methods:{createOverlay(){const e=new a({propsData:{absolute:this.absolute,value:!1,color:this.overlayColor,opacity:this.overlayOpacity}});e.$mount();const t=this.absolute?this.$el.parentNode:document.querySelector("[data-app]");t&&t.insertBefore(e.$el,t.firstChild),this.overlay=e},genOverlay(){if(this.hideScroll(),!this.hideOverlay)return this.overlay||this.createOverlay(),this.animationFrame=requestAnimationFrame((()=>{this.overlay&&(void 0!==this.activeZIndex?this.overlay.zIndex=String(this.activeZIndex-1):this.$el&&(this.overlay.zIndex=(0,o.fl)(this.$el)),this.overlay.value=!0)})),!0},removeOverlay(e=!0){this.overlay&&((0,o.d7)(this.overlay.$el,"transitionend",(()=>{this.overlay&&this.overlay.$el&&this.overlay.$el.parentNode&&!this.overlay.value&&!this.isActive&&(this.overlay.$el.parentNode.removeChild(this.overlay.$el),this.overlay.$destroy(),this.overlay=null)})),cancelAnimationFrame(this.animationFrame),this.overlay.value=!1),e&&this.showScroll()},scrollListener(e){if("key"in e){if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)||e.target.isContentEditable)return;const t=[o.uP.up,o.uP.pageup],s=[o.uP.down,o.uP.pagedown];if(t.includes(e.keyCode))e.deltaY=-1;else{if(!s.includes(e.keyCode))return;e.deltaY=1}}(e.target===this.overlay||"keydown"!==e.type&&e.target===document.body||this.checkPath(e))&&e.preventDefault()},hasScrollbar(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const t=window.getComputedStyle(e);return(["auto","scroll"].includes(t.overflowY)||"SELECT"===e.tagName)&&e.scrollHeight>e.clientHeight||["auto","scroll"].includes(t.overflowX)&&e.scrollWidth>e.clientWidth},shouldScroll(e,t){if(e.hasAttribute("data-app"))return!1;const s=t.shiftKey||t.deltaX?"x":"y",i="y"===s?t.deltaY:t.deltaX||t.deltaY;let a,o;"y"===s?(a=0===e.scrollTop,o=e.scrollTop+e.clientHeight===e.scrollHeight):(a=0===e.scrollLeft,o=e.scrollLeft+e.clientWidth===e.scrollWidth);const r=i<0,l=i>0;return!(a||!r)||(!(o||!l)||!(!a&&!o||!e.parentNode)&&this.shouldScroll(e.parentNode,t))},isInside(e,t){return e===t||null!==e&&e!==document.body&&this.isInside(e.parentNode,t)},checkPath(e){const t=(0,o.K9)(e);if("keydown"===e.type&&t[0]===document.body){const t=this.$refs.dialog,s=window.getSelection().anchorNode;return!(t&&this.hasScrollbar(t)&&this.isInside(s,t))||!this.shouldScroll(t,e)}for(let s=0;s<t.length;s++){const i=t[s];if(i===document)return!0;if(i===document.documentElement)return!0;if(i===this.$refs.content)return!0;if(this.hasScrollbar(i))return!this.shouldScroll(i,e)}return!0},hideScroll(){this.$vuetify.breakpoint.smAndDown?document.documentElement.classList.add("overflow-y-hidden"):((0,o.P4)(window,"wheel",this.scrollListener,{passive:!1}),window.addEventListener("keydown",this.scrollListener))},showScroll(){document.documentElement.classList.remove("overflow-y-hidden"),window.removeEventListener("wheel",this.scrollListener),window.removeEventListener("keydown",this.scrollListener)}}})}}]);
//# sourceMappingURL=browse-readlist.37957ad5.js.map