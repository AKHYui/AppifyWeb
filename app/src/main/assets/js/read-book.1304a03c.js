"use strict";(self["webpackChunkkomga_webui"]=self["webpackChunkkomga_webui"]||[]).push([[8151],{4395:function(e,t,i){i.d(t,{A:function(){return b}});var s=i(73847),o=i(16684),n=i(18748),a=i(94026),r=i(5291),l=i(69791),c=i(30376),u=function(){var e=this,t=e._self._c;e._self._setupProxy;return t(c.A,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(s.A,e._g({attrs:{icon:""}},i),[t(o.A,[e._v("mdi-view-grid-plus")])],1)]}}])},[t(n.A,{attrs:{dark:e.dark}},[t(r.A,{model:{value:e.selection,callback:function(t){e.selection=t},expression:"selection"}},e._l(e.items,(function(i,s){return t(a.A,{key:s,on:{click:function(t){return e.setPageSize(i)}}},[t(l.UZ,[e._v(e._s(i))])],1)})),1)],1)],1)},h=[],d=i(85471),g=d.Ay.extend({name:"PageSizeSelect",data:()=>({selection:0}),props:{items:{type:Array,default:()=>[20,50,100,200,500]},value:{type:Number,required:!0},dark:{type:Boolean,default:!1}},watch:{value:{handler(e){this.selection=this.items.findIndex((t=>t===e))},immediate:!0}},methods:{setPageSize(e){this.$emit("input",e)}}}),p=g,m=i(81656),A=(0,m.A)(p,u,h,!1,null,"57c54c90",null),b=A.exports},53077:function(e,t,i){i.r(t),i.d(t,{default:function(){return Ze}});var s,o=i(87158),n=i(73847),a=i(30089),r=i(21253),l=i(1231),c=i(70793),u=i(16684),h=i(39858),d=i(18748),g=i(94026),p=i(69791),m=i(30376),A=i(22369),b=i(80700),f=i(47679),v=i(48166),k=i(40005),_=i(26804),y=i(75704),w=i(26702),x=i(84551),$=function(){var e=this,t=e._self._c;e._self._setupProxy;return e.pages.length>0?t(c.A,{staticClass:"ma-0 pa-0 full-height",style:`width: 100%; background-color: ${e.backgroundColor}`,attrs:{fluid:""}},[t("div",[t(b.QG,[e.showToolbars?t(y.A,{staticClass:"settings full-width",staticStyle:{position:"fixed",top:"0"},attrs:{dense:"",elevation:"1"}},[t(n.A,{attrs:{icon:""},on:{click:e.closeBook}},[t(u.A,[e._v("mdi-arrow-left")])],1),t(w.sw,[e._v(" "+e._s(e.bookTitle))]),t(k.A),e.incognito?t(x.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(u.A,e._g({},i),[e._v("mdi-incognito")])]}}],null,!1,4037463923)},[t("span",[e._v(e._s(e.$t("bookreader.tooltip_incognito")))])]):e._e(),t(n.A,{attrs:{icon:"",disabled:!e.screenfull.isEnabled},on:{click:function(t){e.screenfull.isFullscreen?e.screenfull.exit():e.enterFullscreen()}}},[t(u.A,[e._v(e._s(e.fullscreenIcon))])],1),t(n.A,{attrs:{icon:""},on:{click:function(t){e.showHelp=!e.showHelp}}},[t(u.A,[e._v("mdi-help-circle")])],1),t(n.A,{attrs:{icon:""},on:{click:function(t){e.showExplorer=!e.showExplorer}}},[t(u.A,[e._v("mdi-view-grid")])],1),t(n.A,{attrs:{icon:""},on:{click:function(t){e.showSettings=!e.showSettings}}},[t(u.A,[e._v("mdi-cog")])],1),t(m.A,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(n.A,e._g({attrs:{icon:""},on:{click:function(e){e.preventDefault()}}},i),[t(u.A,[e._v("mdi-dots-vertical")])],1)]}}],null,!1,863602117)},[t(d.A,[t(g.A,{on:{click:e.downloadCurrentPage}},[t(p.UZ,[e._v(e._s(e.$t("bookreader.download_current_page")))])],1),t(g.A,{on:{click:function(t){return e.setCurrentPageAsPoster(e.ItemTypes.BOOK)}}},[t(p.UZ,[e._v(e._s(e.$t("bookreader.set_current_page_as_book_poster")))])],1),e.book.oneshot?e._e():t(g.A,{on:{click:function(t){return e.setCurrentPageAsPoster(e.ItemTypes.SERIES)}}},[t(p.UZ,[e._v(e._s(e.$t("bookreader.set_current_page_as_series_poster")))])],1),e.contextReadList?t(g.A,{on:{click:function(t){return e.setCurrentPageAsPoster(e.ItemTypes.READLIST)}}},[t(p.UZ,[e._v(e._s(e.$t("bookreader.set_current_page_as_readlist_poster")))])],1):e._e()],1)],1)],1):e._e()],1),t(b.wc,[e.showToolbars?t(y.A,{staticClass:"settings full-width",staticStyle:{position:"fixed",bottom:"0"},attrs:{dense:"",elevation:"1",horizontal:""}},[t(A.A,{attrs:{justify:"center"}},[t(l.A,{staticClass:"px-0"},[t(f.A,{staticClass:"align-center",attrs:{"hide-details":"","thumb-label":"",min:"1",max:e.pagesCount},on:{change:e.goTo},scopedSlots:e._u([{key:"prepend",fn:function(){return[t(u.A,{on:{click:e.previousBook}},[e._v("mdi-undo")]),t(u.A,{staticClass:"mx-2",on:{click:e.goToFirst}},[e._v("mdi-skip-previous")]),t(h.A,[e._v(" "+e._s(e.page)+" ")])]},proxy:!0},{key:"append",fn:function(){return[t(h.A,[e._v(" "+e._s(e.pagesCount)+" ")]),t(u.A,{staticClass:"mx-1",on:{click:e.goToLast}},[e._v("mdi-skip-next")]),t(u.A,{on:{click:e.nextBook}},[e._v("mdi-redo")])]},proxy:!0}],null,!1,2908394224),model:{value:e.goToPage,callback:function(t){e.goToPage=t},expression:"goToPage"}})],1)],1)],1):e._e()],1)],1),t("div",{staticClass:"full-height"},[e.continuousReader?t("continuous-reader",{attrs:{pages:e.pages,page:e.page,animations:e.animations,scale:e.continuousScale,sidePadding:e.sidePadding,"page-margin":e.pageMargin},on:{"update:page":function(t){e.page=t},menu:function(t){return e.toggleToolbars()},"jump-previous":function(t){return e.jumpToPrevious()},"jump-next":function(t){return e.jumpToNext()}}}):t("paged-reader",{attrs:{pages:e.pages,page:e.page,"reading-direction":e.readingDirection,"page-layout":e.pageLayout,scale:e.scale,animations:e.animations,swipe:e.swipe},on:{"update:page":function(t){e.page=t},menu:function(t){return e.toggleToolbars()},"jump-previous":function(t){return e.jumpToPrevious()},"jump-next":function(t){return e.jumpToNext()}}})],1),t("thumbnail-explorer-dialog",{attrs:{bookId:e.bookId,pagesCount:e.pagesCount},on:{go:e.goTo},model:{value:e.showExplorer,callback:function(t){e.showExplorer=t},expression:"showExplorer"}}),t(o.A,{attrs:{"close-on-content-click":!1,"max-width":"500",scrollable:""},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;t.stopPropagation()}},model:{value:e.showSettings,callback:function(t){e.showSettings=t},expression:"showSettings"}},[t(a.A,[t(y.A,{attrs:{dark:"",color:"primary"}},[t(n.A,{attrs:{icon:"",dark:""},on:{click:function(t){e.showSettings=!1}}},[t(u.A,[e._v("mdi-close")])],1),t(w.sw,[e._v(e._s(e.$t("bookreader.reader_settings")))])],1),t(r.OQ,{staticClass:"pa-0"},[t(d.A,{staticClass:"full-height full-width"},[t(_.A,{staticClass:"font-weight-black text-h6"},[e._v(e._s(e.$t("bookreader.settings.general")))]),t(g.A,[t("settings-select",{attrs:{items:e.readingDirs,label:e.$t("bookreader.settings.reading_mode")},model:{value:e.readingDirection,callback:function(t){e.readingDirection=t},expression:"readingDirection"}})],1),t(g.A,[t("settings-switch",{attrs:{label:e.$t("bookreader.settings.animate_page_transitions")},model:{value:e.animations,callback:function(t){e.animations=t},expression:"animations"}})],1),t(g.A,[t("settings-switch",{attrs:{label:e.$t("bookreader.settings.gestures")},model:{value:e.swipe,callback:function(t){e.swipe=t},expression:"swipe"}})],1),t(g.A,[t("settings-switch",{attrs:{label:e.$t("bookreader.settings.always_fullscreen"),disabled:!e.screenfull.isEnabled},model:{value:e.alwaysFullscreen,callback:function(t){e.alwaysFullscreen=t},expression:"alwaysFullscreen"}})],1),t(_.A,{staticClass:"font-weight-black text-h6"},[e._v(e._s(e.$t("bookreader.settings.display")))]),t(g.A,[t("settings-select",{attrs:{items:e.backgroundColors,label:e.$t("bookreader.settings.background_color")},model:{value:e.backgroundColor,callback:function(t){e.backgroundColor=t},expression:"backgroundColor"}})],1),e.continuousReader?[t(_.A,{staticClass:"font-weight-black text-h6"},[e._v(e._s(e.$t("bookreader.settings.webtoon")))]),t(g.A,[t("settings-select",{attrs:{items:e.continuousScaleTypes,label:e.$t("bookreader.settings.scale_type")},model:{value:e.continuousScale,callback:function(t){e.continuousScale=t},expression:"continuousScale"}})],1),t(g.A,[t("settings-select",{attrs:{items:e.paddingPercentages,label:e.$t("bookreader.settings.side_padding")},model:{value:e.sidePadding,callback:function(t){e.sidePadding=t},expression:"sidePadding"}})],1),t(g.A,[t("settings-select",{attrs:{items:e.marginValues,label:e.$t("bookreader.settings.page_margin")},model:{value:e.pageMargin,callback:function(t){e.pageMargin=t},expression:"pageMargin"}})],1)]:e._e(),e.continuousReader?e._e():[t(_.A,{staticClass:"font-weight-black text-h6"},[e._v(e._s(e.$t("bookreader.settings.paged")))]),t(g.A,[t("settings-select",{attrs:{items:e.scaleTypes,label:e.$t("bookreader.settings.scale_type")},model:{value:e.scale,callback:function(t){e.scale=t},expression:"scale"}})],1),t(g.A,[t("settings-select",{attrs:{items:e.pageLayouts,label:e.$t("bookreader.settings.page_layout")},model:{value:e.pageLayout,callback:function(t){e.pageLayout=t},expression:"pageLayout"}})],1)]],2)],1)],1)],1),t(v.A,{staticClass:"mt-12",attrs:{timeout:e.jumpConfirmationDelay,top:"",color:"rgba(0, 0, 0, 0.8)","multi-line":""},model:{value:e.jumpToPreviousBook,callback:function(t){e.jumpToPreviousBook=t},expression:"jumpToPreviousBook"}},[t("div",{staticClass:"body-1 pa-6"},[t("p",[e._v(e._s(e.$t("bookreader.beginning_of_book")))]),e.$_.isEmpty(e.siblingPrevious)?e._e():t("p",[e._v(e._s(e.$t("bookreader.move_previous")))])])]),t(v.A,{staticClass:"mt-12",attrs:{timeout:e.jumpConfirmationDelay,top:"",color:"rgba(0, 0, 0, 0.8)","multi-line":""},model:{value:e.jumpToNextBook,callback:function(t){e.jumpToNextBook=t},expression:"jumpToNextBook"}},[t("div",{staticClass:"text-body-1 pa-6"},[t("p",[e._v(e._s(e.$t("bookreader.end_of_book")))]),e.$_.isEmpty(e.siblingNext)?t("p",[e._v(e._s(e.$t("bookreader.move_next_exit")))]):t("p",[e._v(e._s(e.$t("bookreader.move_next")))])])]),t(v.A,{attrs:{color:"rgba(0, 0, 0, 0.8)",bottom:"",timeout:"3000"},model:{value:e.notificationReadingDirection.enabled,callback:function(t){e.$set(e.notificationReadingDirection,"enabled",t)},expression:"notificationReadingDirection.enabled"}},[t("p",{staticClass:"text-body-1 text-center ma-0"},[e._v(" "+e._s(e.readingDirectionText)+e._s(e.notificationReadingDirection.fromMetadata?"("+e.$t("bookreader.from_series_metadata")+")":"")+" ")])]),t(v.A,{attrs:{color:"rgba(0, 0, 0, 0.8)",centered:"",timeout:e.notification.timeout},model:{value:e.notification.enabled,callback:function(t){e.$set(e.notification,"enabled",t)},expression:"notification.enabled"}},[t("p",{staticClass:"text-h6 text-center ma-0"},[e._v(" "+e._s(e.notification.message)+" ")])]),t("shortcut-help-dialog",{attrs:{shortcuts:e.shortcutsHelp},model:{value:e.showHelp,callback:function(t){e.showHelp=t},expression:"showHelp"}})],1):e._e()},P=[],S=(i(28743),i(14602),i(62554),i(2543)),T=i(5760),E=i(7059),I=i(92872),L=i(13812),C=i(6231),B=function(){var e=this,t=e._self._c;e._self._setupProxy;return t(I.A,{attrs:{scrollable:""},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;t.stopPropagation()}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}},[t(a.A,{attrs:{"max-height":.9*e.$vuetify.breakpoint.height,dark:""}},[t(r.ri,{staticClass:"justify-center"},[t(C.A,{attrs:{"total-visible":e.perPage,length:Math.ceil(e.thumbnails.length/e.perPage)},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}),t("page-size-select",{attrs:{dark:"",items:[10,20,50,100]},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}})],1),t(r.OQ,[t(c.A,{attrs:{fluid:""}},[t(A.A,{staticClass:"mb-2 align-center justify-space-around"},e._l(e.visibleThumbnails,(function(i,s){return t("div",{key:i,staticClass:"d-flex flex-column justify-center",staticStyle:{"min-height":"220px","max-width":"140px"}},[t(L.A,{staticClass:"ma-2",staticStyle:{cursor:"pointer"},attrs:{src:i,"aspect-ratio":"0.7071",contain:"",height:"200",width:"140"},on:{click:function(t){e.input=!1,e.goTo((e.page-1)*e.perPage+s+1)}}}),t("div",{staticClass:"white--text text-center font-weight-bold"},[e._v(e._s((e.page-1)*e.perPage+s+1))])],1)})),0)],1)],1)],1)],1)},D=[],R=i(85471),N=i(33513),O=i(4395),j=R.Ay.extend({name:"ThumbnailExplorerDialog",components:{PageSizeSelect:O.A},props:{pagesCount:{type:Number},value:{type:Boolean},bookId:{type:String}},data:()=>({input:"",page:1,perPage:10}),watch:{value(e){this.input=e},input(e){!e&&this.$emit("input",!1)},perPage(e){this.$store.commit("setThumbnailsPageSize",e)}},mounted(){this.perPage=this.$store.state.persistedState.thumbnailsPageSize||this.perPage},computed:{thumbnails(){let e=[];for(let t=1;t<=this.pagesCount;t++)e.push(this.getThumbnailUrl(t));return e},visibleThumbnails(){let e=(this.page-1)*this.perPage,t=this.page*this.perPage;return this.thumbnails.slice(e,t)}},methods:{updateInput(){this.$emit("input",this.input)},goTo(e){this.$emit("go",e)},getThumbnailUrl(e){return(0,N.oG)(this.bookId,e)}}}),W=j,H=i(81656),G=(0,H.A)(W,B,D,!1,null,null,null),M=G.exports,q=i(68566),F=i(9401);function U(e,t){const i=new Image;switch(i.onload=function(){t(i.width>0&&i.height>0)},i.onerror=function(){t(!1)},e){case s.WEBP_LOSSY:i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";break;case s.WEBP_LOSSLESS:i.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==";break;case s.WEBP_ALPHA:i.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==";break;case s.WEBP_ANIMATION:i.src="data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA";break;case s.JPEG_XL:i.src="data:image/jxl;base64,/woIELASCAgQAFwASxLFgkWAHL0xqnCBCV0qDp901Te/5QM=";break;case s.AVIF:i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=";break}}(function(e){e[e["WEBP_LOSSY"]=0]="WEBP_LOSSY",e[e["WEBP_LOSSLESS"]=1]="WEBP_LOSSLESS",e[e["WEBP_ALPHA"]=2]="WEBP_ALPHA",e[e["WEBP_ANIMATION"]=3]="WEBP_ANIMATION",e[e["JPEG_XL"]=4]="JPEG_XL",e[e["AVIF"]=5]="AVIF"})(s||(s={}));var Q=i(26949);i(30789),i(60933),i(96380),i(91059),i(42838);function V(e){return new Promise((t=>{e.toBlob((e=>{t(e)}))}))}async function z(e,t=500,i=500){const s=document.createElement("canvas"),o=s.getContext("2d");if(null!==o){const n=new Image;n.src=URL.createObjectURL(e),await n.decode();let a=n.width,r=n.height;a>r?a>t&&(r*=t/a,a=t):r>i&&(a*=i/r,r=i),s.width=a,s.height=r,URL.revokeObjectURL(n.src),o.drawImage(n,0,0,a,r);const l=await V(s);if(null!==l)return new File([l],"poster",{lastModified:Date.now()})}return e}var Y=i(79957),K=i(94475),X=i(39945),Z=i(54582),J=i(47029),ee=i(87375),te=i(69463),ie=i(73803),se=K.A.extend({name:"v-carousel",props:{continuous:{type:Boolean,default:!0},cycle:Boolean,delimiterIcon:{type:String,default:"$delimiter"},height:{type:[Number,String],default:500},hideDelimiters:Boolean,hideDelimiterBackground:Boolean,interval:{type:[Number,String],default:6e3,validator:e=>e>0},mandatory:{type:Boolean,default:!0},progress:Boolean,progressColor:String,showArrows:{type:Boolean,default:!0},verticalDelimiters:{type:String,default:void 0}},provide(){return{parentTheme:this.theme}},data(){return{internalHeight:this.height,slideTimeout:void 0}},computed:{classes(){return{...K.A.options.computed.classes.call(this),"v-carousel":!0,"v-carousel--hide-delimiter-background":this.hideDelimiterBackground,"v-carousel--vertical-delimiters":this.isVertical}},isDark(){return this.dark||!this.light},isVertical(){return null!=this.verticalDelimiters}},watch:{internalValue:"restartTimeout",interval:"restartTimeout",height(e,t){e!==t&&e&&(this.internalHeight=e)},cycle(e){e?this.restartTimeout():(clearTimeout(this.slideTimeout),this.slideTimeout=void 0)}},created(){this.$attrs.hasOwnProperty("hide-controls")&&(0,ie.q4)("hide-controls",':show-arrows="false"',this)},mounted(){this.startTimeout()},methods:{genControlIcons(){return this.isVertical?null:K.A.options.methods.genControlIcons.call(this)},genDelimiters(){return this.$createElement("div",{staticClass:"v-carousel__controls",style:{left:"left"===this.verticalDelimiters&&this.isVertical?0:"auto",right:"right"===this.verticalDelimiters?0:"auto"}},[this.genItems()])},genItems(){const e=this.items.length,t=[];for(let i=0;i<e;i++){const s=this.$createElement(X.A,{staticClass:"v-carousel__controls__item",attrs:{"aria-label":this.$vuetify.lang.t("$vuetify.carousel.ariaLabel.delimiter",i+1,e)},props:{icon:!0,small:!0,value:this.getValue(this.items[i],i)},key:i},[this.$createElement(Z.A,{props:{size:18}},this.delimiterIcon)]);t.push(s)}return this.$createElement(ee.A,{props:{value:this.internalValue,mandatory:this.mandatory},on:{change:e=>{this.internalValue=e}}},t)},genProgress(){return this.$createElement(J.A,{staticClass:"v-carousel__progress",props:{color:this.progressColor,value:(this.internalIndex+1)/this.items.length*100}})},restartTimeout(){this.slideTimeout&&clearTimeout(this.slideTimeout),this.slideTimeout=void 0,window.requestAnimationFrame(this.startTimeout)},startTimeout(){this.cycle&&(this.slideTimeout=window.setTimeout(this.next,+this.interval>0?+this.interval:6e3))}},render(e){const t=K.A.options.render.call(this,e);return t.data.style=`height: ${(0,te.Dg)(this.height)};`,this.hideDelimiters||t.children.push(this.genDelimiters()),(this.progress||this.progressColor)&&t.children.push(this.genProgress()),t}}),oe=i(62802),ne=i(72006),ae=i(22235);const re=(0,ne.A)(oe.A,ae.A);var le,ce,ue,he=re.extend().extend({name:"v-carousel-item",inject:{parentTheme:{default:{isDark:!1}}},provide(){return{theme:this.parentTheme}},inheritAttrs:!1,methods:{genDefaultSlot(){return[this.$createElement(L.A,{staticClass:"v-carousel__item",props:{...this.$attrs,height:this.windowGroup.internalHeight},on:this.$listeners,scopedSlots:{placeholder:this.$scopedSlots.placeholder}},(0,te.$c)(this))]},genWindowItem(){const{tag:e,data:t}=this.generateRouteLink();return t.staticClass="v-window-item",t.directives.push({name:"show",value:this.isActive}),this.$createElement(e,t,this.genDefaultSlot())}}}),de=i(3080),ge=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{def:de.A,name:"touch",rawName:"v-touch",value:{left:()=>{e.swipe&&e.turnRight()},right:()=>{e.swipe&&e.turnLeft()},up:()=>{e.swipe&&e.verticalNext()},down:()=>{e.swipe&&e.verticalPrev()}},expression:"{\n             left: () => {if(swipe) {turnRight()}},\n             right: () => {if(swipe) {turnLeft()}},\n             up: () => {if(swipe) {verticalNext()}},\n             down: () => {if(swipe) {verticalPrev()}}\n           }"}]},[t(se,{attrs:{"show-arrows":!1,continuous:!1,reverse:e.flipDirection,vertical:e.vertical,"hide-delimiters":"",touchless:"",height:"100%"},model:{value:e.carouselPage,callback:function(t){e.carouselPage=t},expression:"carouselPage"}},e._l(e.spreads,(function(i,s){return t(he,{key:`spread${s}`,staticClass:"full-height",class:e.preRender(s)?"pre-render":"",attrs:{eager:e.eagerLoad(s),transition:!!e.animations&&void 0,"reverse-transition":!!e.animations&&void 0}},[t("div",{staticClass:"full-height d-flex flex-column justify-center"},[t("div",{class:`d-flex flex-row${e.flipDirection?"-reverse":""} justify-center px-0 mx-0`},e._l(i,(function(o,n){return t("img",{key:`spread${s}-${n}`,staticClass:"img-fit-all",class:e.imgClass(i),attrs:{alt:`Page ${o.number}`,src:o.url}})})),0)])])})),1),e.vertical?e._e():t("div",{staticClass:"left-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.turnLeft()}}}),e.vertical?e._e():t("div",{staticClass:"right-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.turnRight()}}}),e.vertical?t("div",{staticClass:"top-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.verticalPrev()}}}):e._e(),e.vertical?t("div",{staticClass:"bottom-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.verticalNext()}}}):e._e(),t("div",{class:""+(e.vertical?"center-vertical":"center-horizontal"),staticStyle:{"z-index":"1"},on:{click:function(t){return e.centerClick()}}})],1)},pe=[];(function(e){e["SCREEN"]="bookreader.scale_type.screen",e["WIDTH"]="bookreader.scale_type.width",e["WIDTH_SHRINK_ONLY"]="bookreader.scale_type.width_shrink_only",e["HEIGHT"]="bookreader.scale_type.height",e["ORIGINAL"]="bookreader.scale_type.original"})(le||(le={})),function(e){e["WIDTH"]="bookreader.scale_type.continuous_width",e["ORIGINAL"]="bookreader.scale_type.continuous_original"}(ce||(ce={})),function(e){e["SINGLE_PAGE"]="bookreader.paged_reader_layout.single",e["DOUBLE_PAGES"]="bookreader.paged_reader_layout.double",e["DOUBLE_NO_COVER"]="bookreader.paged_reader_layout.double_no_cover"}(ue||(ue={}));const me=[0,5,10,15,20,25,30,35,40],Ae=[0,5,10,15];var be=i(5204);const fe=[new be.r("bookreader.shortcuts.previous_page",(e=>{e.turnLeft()}),"ArrowLeft","←"),new be.r("bookreader.shortcuts.next_page",(e=>{e.turnRight()}),"ArrowRight","→")],ve=[new be.r("bookreader.shortcuts.previous_page",(e=>{e.turnRight()}),"ArrowRight","→"),new be.r("bookreader.shortcuts.next_page",(e=>{e.turnLeft()}),"ArrowLeft","←")],ke=[new be.r("bookreader.shortcuts.previous_page",(e=>{e.verticalPrev()}),"ArrowUp","↑"),new be.r("bookreader.shortcuts.next_page",(e=>{e.verticalNext()}),"ArrowDown","↓")],_e=[new be.r("bookreader.shortcuts.cycle_page_layout",(e=>e.cyclePageLayout()),"d")];function ye(e){var t,i;return(null!==(t=null===e||void 0===e?void 0:e.width)&&void 0!==t?t:0)>(null!==(i=null===e||void 0===e?void 0:e.height)&&void 0!==i?i:0)}function we(e,t){if(0===e.length)return[];if(t!==ue.SINGLE_PAGE){const i=[],s=(0,S.cloneDeep)(e);let o;if(t===ue.DOUBLE_PAGES){const e=s.shift();if(ye(e)?i.push([e]):i.push([xe(e),e]),s.length>0){const e=s.pop();o=ye(e)?[e]:[e,xe(e)]}}while(s.length>0){const e=s.shift();if(ye(e))i.push([e]);else if(s.length>0){const t=s.shift();ye(t)?(i.push([e,xe(e)]),i.push([t])):i.push([e,t])}else i.push([e,xe(e)])}return o&&i.push(o),i}return e.map((e=>[e]))}function xe(e){return{url:$e((null===e||void 0===e?void 0:e.width)||20,(null===e||void 0===e?void 0:e.height)||30),number:0}}function $e(e,t){const i=document.createElement("canvas");i.width=e,i.height=t;const s=i.getContext("2d");return s&&(s.fillStyle="rgb(0,0,0,0)",s.fillRect(0,0,e,t)),i.toDataURL()}var Pe=R.Ay.extend({name:"PagedReader",data:function(){return{logger:"PagedReader",carouselPage:0,spreads:[]}},props:{pages:{type:Array,required:!0},page:{type:Number,required:!0},pageLayout:{type:String,required:!0},animations:{type:Boolean,required:!0},swipe:{type:Boolean,required:!0},readingDirection:{type:String,required:!0},scale:{type:String,required:!0}},watch:{pages:{handler(e){this.spreads=we(e,this.pageLayout)},immediate:!0},carouselPage(e,t){if(this.$debug("[watch:carouselPage",`old:${t}`,`new:${e}`),this.carouselPage>=0&&this.carouselPage<this.spreads.length&&this.spreads.length>0){const e=this.spreads[this.carouselPage],t=2==e.length&&e[1].mediaType?e[1]:e[0];this.$emit("update:page",t.number)}else this.$emit("update:page",1)},page(e,t){this.$debug("[watch:page]",`old:${t}`,`new:${e}`);const i=this.toSpreadIndex(e);this.$debug("[watch:page]",`toSpreadIndex:${i}`),this.carouselPage=i},pageLayout:{handler(e){const t=this.page;this.spreads=we(this.pages,e),this.carouselPage=this.toSpreadIndex(t)},immediate:!0}},created(){window.addEventListener("keydown",this.keyPressed)},destroyed(){window.removeEventListener("keydown",this.keyPressed)},computed:{shortcuts(){const e=[];switch(this.readingDirection){case Y.s3.LEFT_TO_RIGHT:e.push(...fe);break;case Y.s3.RIGHT_TO_LEFT:e.push(...ve);break;case Y.s3.VERTICAL:e.push(...ke);break}return this.$_.keyBy(e,(e=>e.key))},flipDirection(){return this.readingDirection===Y.s3.RIGHT_TO_LEFT},vertical(){return this.readingDirection===Y.s3.VERTICAL},currentSlide(){return this.carouselPage+1},slidesCount(){return this.spreads.length},canPrev(){return this.currentSlide>1},canNext(){return this.currentSlide<this.slidesCount},isDoublePages(){return this.pageLayout===ue.DOUBLE_PAGES||this.pageLayout===ue.DOUBLE_NO_COVER}},methods:{keyPressed(e){var t;null===(t=this.shortcuts[e.key])||void 0===t||t.execute(this)},imgClass(e){const t=e.length>1;switch(this.scale){case le.WIDTH:return t?"img-double-fit-width":"img-fit-width";case le.WIDTH_SHRINK_ONLY:return t?"img-double-fit-width-shrink-only":"img-fit-width-shrink-only";case le.HEIGHT:return"img-fit-height";case le.SCREEN:return t?"img-double-fit-screen":"img-fit-screen";default:return"img-fit-original"}},eagerLoad(e){return Math.abs(this.carouselPage-e)<=2},preRender(e){return Math.abs(this.carouselPage-e)>(this.animations?1:0)},centerClick(){this.$emit("menu")},turnRight(){this.vertical||(this.flipDirection?this.prev():this.next())},turnLeft(){this.vertical||(this.flipDirection?this.next():this.prev())},verticalPrev(){this.vertical&&this.prev()},verticalNext(){this.vertical&&this.next()},prev(){this.canPrev?(this.carouselPage--,window.scrollTo(0,0)):this.$emit("jump-previous")},next(){this.canNext?(this.carouselPage++,window.scrollTo(0,0)):this.$emit("jump-next")},toSpreadIndex(e){if(this.$debug("[toSpreadIndex]",`i:${e}`,`isDoublePages:${this.isDoublePages}`),this.spreads.length>0){if(!this.isDoublePages)return e-1;for(let t=0;t<this.spreads.length;t++)for(let i=0;i<this.spreads[t].length;i++)if(this.spreads[t][i].number===e)return t}return e-1}}}),Se=Pe,Te=(0,H.A)(Se,ge,pe,!1,null,"a26043fa",null),Ee=Te.exports,Ie=i(66530),Le=i(88172),Ce=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",{directives:[{def:Le.A,name:"scroll",rawName:"v-scroll",value:e.onScroll,expression:"onScroll"}],class:"d-flex flex-column px-0 mx-0"},e._l(e.pages,(function(i,s){return t("img",{directives:[{def:Ie.A,name:"intersect",rawName:"v-intersect",value:e.onIntersect,expression:"onIntersect"}],key:`page${s}`,style:`margin: ${0===s?0:e.pageMargin}px auto;`,attrs:{alt:`Page ${i.number}`,src:e.shouldLoad(s)?i.url:void 0,height:e.calcHeight(i),width:e.calcWidth(i),id:`page${i.number}`}})})),0),t("div",{staticClass:"top-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.prev()}}}),t("div",{staticClass:"bottom-quarter",staticStyle:{"z-index":"1"},on:{click:function(t){return e.next()}}}),t("div",{staticClass:"center-vertical",staticStyle:{"z-index":"1"},on:{click:function(t){return e.centerClick()}}})])},Be=[],De=R.Ay.extend({name:"ContinuousReader",data:()=>({offsetTop:0,totalHeight:1e3,currentPage:1,seen:[]}),props:{pages:{type:Array,required:!0},animations:{type:Boolean,required:!0},page:{type:Number,required:!0},scale:{type:String,required:!0},sidePadding:{type:Number,required:!0},pageMargin:{type:Number,required:!0}},watch:{pages:{handler(e){this.seen=new Array(e.length).fill(!1),1===this.page&&window.scrollTo(0,0)},immediate:!0},page:{handler(e){e!=this.currentPage&&this.$vuetify.goTo(`#page${e}`,{duration:0})},immediate:!1}},created(){window.addEventListener("keydown",this.keyPressed)},destroyed(){window.removeEventListener("keydown",this.keyPressed)},mounted(){this.page!=this.currentPage&&this.$vuetify.goTo(`#page${this.page}`,{duration:0})},computed:{canPrev(){return this.offsetTop>0},canNext(){return this.offsetTop+this.$vuetify.breakpoint.height<this.totalHeight},goToOptions(){if(!this.animations)return{duration:0}},totalSidePadding(){return 2*this.sidePadding}},methods:{keyPressed:(0,S.throttle)((function(e){switch(e.key){case" ":case"PageDown":case"ArrowDown":this.canNext||this.$emit("jump-next");break;case"PageUp":case"ArrowUp":this.canPrev||this.$emit("jump-previous");break}}),500),onScroll(e){this.offsetTop=e.target.scrollingElement.scrollTop,this.totalHeight=e.target.scrollingElement.scrollHeight},onIntersect(e){if(e[0].isIntersecting){const t=parseInt(e[0].target.id.replace("page",""));this.seen.splice(t-1,1,!0),this.currentPage=t,this.$emit("update:page",t)}},shouldLoad(e){return 0==e||this.seen[e]||Math.abs(this.currentPage-1-e)<=2},calcHeight(e){switch(this.scale){case ce.WIDTH:return e.height&&e.width?e.height/(e.width/(this.$vuetify.breakpoint.width-this.$vuetify.breakpoint.width*this.totalSidePadding/100)):void 0;case ce.ORIGINAL:return e.height||void 0;default:return}},calcWidth(e){switch(this.scale){case ce.WIDTH:return this.$vuetify.breakpoint.width-this.$vuetify.breakpoint.width*this.totalSidePadding/100;case ce.ORIGINAL:return e.width||void 0;default:return}},centerClick(){this.$emit("menu")},prev(){if(this.canPrev){const e=.95*this.$vuetify.breakpoint.height;this.$vuetify.goTo(this.offsetTop-e,this.goToOptions)}else this.$emit("jump-previous")},next(){if(this.canNext){const e=.95*this.$vuetify.breakpoint.height;this.$vuetify.goTo(this.offsetTop+e,this.goToOptions)}else this.$emit("jump-next")}}}),Re=De,Ne=(0,H.A)(Re,Ce,Be,!1,null,"66300734",null),Oe=Ne.exports;const je=[new be.r("bookreader.shortcuts.left_to_right",(e=>e.changeReadingDir(Y.s3.LEFT_TO_RIGHT)),"l"),new be.r("bookreader.shortcuts.right_to_left",(e=>e.changeReadingDir(Y.s3.RIGHT_TO_LEFT)),"r"),new be.r("bookreader.shortcuts.vertical",(e=>e.changeReadingDir(Y.s3.VERTICAL)),"v"),new be.r("bookreader.shortcuts.webtoon",(e=>e.changeReadingDir(Y.s3.WEBTOON)),"w"),new be.r("bookreader.shortcuts.cycle_scale",(e=>e.cycleScale()),"c"),new be.r("bookreader.shortcuts.fullscreen",(e=>e.switchFullscreen()),"f")],We=[new be.r("bookreader.shortcuts.show_hide_toolbars",(e=>e.toggleToolbars()),"m"),new be.r("bookreader.shortcuts.show_hide_settings",(e=>e.toggleSettings()),"s"),new be.r("bookreader.shortcuts.show_hide_thumbnails",(e=>e.toggleExplorer()),"t"),new be.r("bookreader.shortcuts.show_hide_help",(e=>e.toggleHelp()),"h"),new be.r("bookreader.shortcuts.close",(e=>e.closeDialog()),"Escape")],He=[new be.r("bookreader.shortcuts.first_page",(e=>{e.goToFirst()}),"Home"),new be.r("bookreader.shortcuts.last_page",(e=>{e.goToLast()}),"End")],Ge=[new be.r("bookreader.shortcuts.cycle_side_padding",(e=>e.cycleSidePadding()),"p"),new be.r("bookreader.shortcuts.cycle_page_margin",(e=>e.cyclePageMargin()),"n")];var Me=i(13044),qe=i(46852),Fe=i.n(qe),Ue=i(51916),Qe=i.n(Ue),Ve=i(54919),ze=i(33060),Ye=R.Ay.extend({name:"DivinaReader",components:{ContinuousReader:Oe,PagedReader:Ee,SettingsSwitch:E.A,SettingsSelect:T.A,ThumbnailExplorerDialog:M,ShortcutHelpDialog:q.A},data:function(){return{ItemTypes:Ve.ll,screenfull:Qe(),fullscreenIcon:"mdi-fullscreen",book:{},series:{},context:{},contextName:"",incognito:!1,siblingPrevious:{},siblingNext:{},jumpToNextBook:!1,jumpToPreviousBook:!1,jumpConfirmationDelay:3e3,notificationReadingDirection:{enabled:!1,fromMetadata:!1},pages:[],page:void 0,supportedMediaTypes:["image/jpeg","image/png","image/gif"],convertTo:"jpeg",showExplorer:!1,showToolbars:!1,showSettings:!1,showHelp:!1,goToPage:1,settings:{pageLayout:ue.SINGLE_PAGE,swipe:!1,alwaysFullscreen:!1,animations:!0,scale:le.SCREEN,continuousScale:ce.WIDTH,sidePadding:0,pageMargin:0,readingDirection:Y.s3.LEFT_TO_RIGHT,backgroundColor:"black"},shortcuts:{},notification:{enabled:!1,message:"",timeout:4e3},readingDirs:Object.values(Y.s3).map((e=>({text:this.$i18n.t(`enums.reading_direction.${e}`),value:e}))),scaleTypes:Object.values(le).map((e=>({text:this.$i18n.t(e),value:e}))),continuousScaleTypes:Object.values(ce).map((e=>({text:this.$i18n.t(e),value:e}))),pageLayouts:Object.values(ue).map((e=>({text:this.$i18n.t(e),value:e}))),paddingPercentages:Object.values(me).map((e=>({text:0===e?this.$i18n.t("bookreader.settings.side_padding_none").toString():`${e}%`,value:e}))),marginValues:Object.values(Ae).map((e=>({text:0===e?this.$i18n.t("bookreader.settings.side_padding_none").toString():`${e}px`,value:e}))),backgroundColors:[{text:this.$t("bookreader.settings.background_colors.white").toString(),value:"white"},{text:this.$t("bookreader.settings.background_colors.gray").toString(),value:"#212121"},{text:this.$t("bookreader.settings.background_colors.black").toString(),value:"black"}]}},created(){this.$vuetify.rtl=!1,U(s.WEBP_LOSSY,(e=>{e&&this.supportedMediaTypes.push("image/webp")})),U(s.JPEG_XL,(e=>{e&&this.supportedMediaTypes.push("image/jxl")})),U(s.AVIF,(e=>{e&&this.supportedMediaTypes.push("image/avif")})),this.shortcuts=this.$_.keyBy([...je,..._e,...Ge,...We,...He],(e=>e.key)),window.addEventListener("keydown",this.keyPressed),Qe().isEnabled&&Qe().on("change",this.fullscreenChanged)},async mounted(){document.documentElement.classList.add("html-reader"),this.$debug("[mounted]","route.query:",this.$route.query),this.readingDirection=this.$store.state.persistedState.webreader.readingDirection,this.animations=this.$store.state.persistedState.webreader.animations,this.pageLayout=this.$store.state.persistedState.webreader.paged.pageLayout,this.swipe=this.$store.state.persistedState.webreader.swipe,this.alwaysFullscreen=this.$store.state.persistedState.webreader.alwaysFullscreen,this.scale=this.$store.state.persistedState.webreader.paged.scale,this.continuousScale=this.$store.state.persistedState.webreader.continuous.scale,this.sidePadding=this.$store.state.persistedState.webreader.continuous.padding,this.backgroundColor=this.$store.state.persistedState.webreader.background,this.setup(this.bookId,Number(this.$route.query.page))},destroyed(){document.documentElement.classList.remove("html-reader"),this.$vuetify.rtl="true"===this.$t("common.locale_rtl"),window.removeEventListener("keydown",this.keyPressed),Qe().isEnabled&&(Qe().off("change",this.fullscreenChanged),Qe().exit())},props:{bookId:{type:String,required:!0}},async beforeRouteUpdate(e,t,i){e.params.bookId!==t.params.bookId&&(this.$debug("[beforeRouteUpdate]","to.query:",e.query),this.setup(e.params.bookId,Number(e.query.page))),i()},watch:{page:{handler(e,t){e&&(this.markProgress(e),this.goToPage=e,this.updateRoute())},immediate:!0}},computed:{continuousReader(){return this.readingDirection===Y.s3.WEBTOON},progress(){return this.page/this.pagesCount*100},pagesCount(){return this.pages.length},bookTitle(){return(0,F.P)(this.book.metadata.title,this.series.metadata.title,this.book.oneshot?void 0:this.book.metadata.number)},readingDirectionText(){return this.$t(`enums.reading_direction.${this.readingDirection}`).toString()},shortcutsHelp(){let e=[];switch(this.readingDirection){case Y.s3.LEFT_TO_RIGHT:e.push(...fe,...He);break;case Y.s3.RIGHT_TO_LEFT:e.push(...ve,...He);break;case Y.s3.VERTICAL:e.push(...ke,...He);break;default:e.push(...He)}let t=[...je];return this.continuousReader?t.push(...Ge):t.push(..._e),{[this.$t("bookreader.shortcuts.reader_navigation").toString()]:e,[this.$t("bookreader.shortcuts.settings").toString()]:t,[this.$t("bookreader.shortcuts.menus").toString()]:We}},contextReadList(){return this.context.origin===Me.E.READLIST},currentPage(){return this.pages[this.page-1]},animations:{get:function(){return this.settings.animations},set:function(e){this.settings.animations=e,this.$store.commit("setWebreaderAnimations",e)}},scale:{get:function(){return this.settings.scale},set:function(e){Object.values(le).includes(e)&&(this.settings.scale=e,this.$store.commit("setWebreaderPagedScale",e))}},continuousScale:{get:function(){return this.settings.continuousScale},set:function(e){Object.values(ce).includes(e)&&(this.settings.continuousScale=e,this.$store.commit("setWebreaderContinuousScale",e))}},sidePadding:{get:function(){return this.settings.sidePadding},set:function(e){me.includes(e)&&(this.settings.sidePadding=e,this.$store.commit("setWebreaderContinuousPadding",e))}},pageMargin:{get:function(){return this.settings.pageMargin},set:function(e){Ae.includes(e)&&(this.settings.pageMargin=e,this.$store.commit("setWebreaderContinuousMargin",e))}},backgroundColor:{get:function(){return this.settings.backgroundColor},set:function(e){this.backgroundColors.map((e=>e.value)).includes(e)&&(this.settings.backgroundColor=e,this.$store.commit("setWebreaderBackground",e))}},readingDirection:{get:function(){return this.settings.readingDirection},set:function(e){Object.values(Y.s3).includes(e)&&(this.settings.readingDirection=e,this.$store.commit("setWebreaderReadingDirection",e))}},pageLayout:{get:function(){return this.settings.pageLayout},set:function(e){Object.values(ue).includes(e)&&(this.settings.pageLayout=e,this.$store.commit("setWebreaderPagedPageLayout",e))}},swipe:{get:function(){return this.settings.swipe},set:function(e){this.settings.swipe=e,this.$store.commit("setWebreaderSwipe",e)}},alwaysFullscreen:{get:function(){return this.settings.alwaysFullscreen},set:function(e){this.settings.alwaysFullscreen=e,this.$store.commit("setWebreaderAlwaysFullscreen",e),e?this.enterFullscreen():Qe().isEnabled&&Qe().exit()}}},methods:{enterFullscreen(){Qe().isEnabled&&Qe().request(document.documentElement,{navigationUI:"hide"})},switchFullscreen(){Qe().isEnabled&&(Qe().isFullscreen?Qe().exit():this.enterFullscreen())},fullscreenChanged(){Qe().isEnabled&&Qe().isFullscreen?this.fullscreenIcon="mdi-fullscreen-exit":this.fullscreenIcon="mdi-fullscreen"},keyPressed(e){var t;e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||null===(t=this.shortcuts[e.key])||void 0===t||t.execute(this)},async setup(e,t){var i;this.$debug("[setup]",`bookId:${e}`,`page:${t}`),this.book=await this.$komgaBooks.getBook(e),this.series=await this.$komgaSeries.getOneSeries(this.book.seriesId),this.$route.query.contextId&&this.$route.query.context&&Object.values(Me.E).includes(this.$route.query.context)&&(this.context={origin:this.$route.query.context,id:this.$route.query.contextId},this.book.context=this.context),(null===this||void 0===this?void 0:this.context.origin)===Me.E.READLIST?(this.contextName=(await this.$komgaReadLists.getOneReadList(this.context.id)).name,document.title=`Komga - ${this.contextName} - ${this.book.metadata.title}`):document.title=`Komga - ${this.bookTitle}`,this.incognito=!(!this.$route.query.incognito||"true"!==this.$route.query.incognito.toString().toLowerCase());const s=await this.$komgaBooks.getBookPages(e);if(s.forEach((e=>e["url"]=this.getPageUrl(e))),this.pages=s,this.$debug("[setup]",`pages count:${this.pagesCount}`,"read progress:",this.book.readProgress),t&&t>=1&&t<=this.pagesCount)this.goTo(t);else if(!1===(null===(i=this.book.readProgress)||void 0===i?void 0:i.completed)){var o;this.goTo(null===(o=this.book.readProgress)||void 0===o?void 0:o.page)}else this.goToFirst();this.series.metadata.readingDirection in Y.s3&&this.readingDirection!==this.series.metadata.readingDirection?(this.settings.readingDirection=this.series.metadata.readingDirection,this.sendNotificationReadingDirection(!0)):this.sendNotificationReadingDirection(!1);try{(null===this||void 0===this?void 0:this.context.origin)===Me.E.READLIST?this.siblingNext=await this.$komgaReadLists.getBookSiblingNext(this.context.id,e):this.siblingNext=await this.$komgaBooks.getBookSiblingNext(e)}catch(n){this.siblingNext={}}try{(null===this||void 0===this?void 0:this.context.origin)===Me.E.READLIST?this.siblingPrevious=await this.$komgaReadLists.getBookSiblingPrevious(this.context.id,e):this.siblingPrevious=await this.$komgaBooks.getBookSiblingPrevious(e)}catch(n){this.siblingPrevious={}}},getPageUrl(e){return this.supportedMediaTypes.includes(e.mediaType)?(0,N.ue)(this.bookId,e.number):(0,N.ue)(this.bookId,e.number,this.convertTo)},jumpToPrevious(){this.jumpToPreviousBook?this.previousBook():this.jumpToPreviousBook=!0},jumpToNext(){this.jumpToNextBook?this.nextBook():this.jumpToNextBook=!0},previousBook(){this.$_.isEmpty(this.siblingPrevious)||(this.jumpToPreviousBook=!1,this.$router.push({name:(0,ze.Z)(this.siblingPrevious.media),params:{bookId:this.siblingPrevious.id.toString()},query:{context:this.context.origin,contextId:this.context.id,incognito:this.incognito.toString()}}))},nextBook(){this.$_.isEmpty(this.siblingNext)?this.closeBook():(this.jumpToNextBook=!1,this.$router.push({name:(0,ze.Z)(this.siblingNext.media),params:{bookId:this.siblingNext.id.toString()},query:{context:this.context.origin,contextId:this.context.id,incognito:this.incognito.toString()}}))},goTo(e){this.$debug("[goTo]",`page:${e}`),this.page=e,this.markProgress(e)},goToFirst(){this.goTo(1)},goToLast(){this.goTo(this.pagesCount)},updateRoute(){this.$router.replace({name:this.$route.name,params:{bookId:this.$route.params.bookId},query:{page:this.page.toString(),context:this.context.origin,contextId:this.context.id,incognito:this.incognito.toString()}})},closeBook(){this.$router.push({name:this.book.oneshot?"browse-oneshot":"browse-book",params:{bookId:this.bookId.toString(),seriesId:this.book.seriesId},query:{context:this.context.origin,contextId:this.context.id}})},changeReadingDir(e){this.readingDirection=e;const t=this.$t(`enums.reading_direction.${this.readingDirection}`);this.sendNotification(`${this.$t("bookreader.changing_reading_direction")}: ${t}`)},cycleScale(){if(this.continuousReader){const e=Object.values(ce),t=(e.indexOf(this.settings.continuousScale)+1)%e.length;this.continuousScale=e[t];const i=this.$t(this.continuousScale);this.sendNotification(`${this.$t("bookreader.cycling_scale")}: ${i}`)}else{const e=Object.values(le),t=(e.indexOf(this.settings.scale)+1)%e.length;this.scale=e[t];const i=this.$t(this.scale);this.sendNotification(`${this.$t("bookreader.cycling_scale")}: ${i}`)}},cycleSidePadding(){if(this.continuousReader){const e=(me.indexOf(this.settings.sidePadding)+1)%me.length;this.sidePadding=me[e];const t=0===this.sidePadding?this.$t("bookreader.settings.side_padding_none").toString():`${this.sidePadding}%`;this.sendNotification(`${this.$t("bookreader.cycling_side_padding")}: ${t}`)}},cyclePageMargin(){if(this.continuousReader){const e=(Ae.indexOf(this.settings.pageMargin)+1)%Ae.length;this.pageMargin=Ae[e];const t=0===this.pageMargin?this.$t("bookreader.settings.side_padding_none").toString():`${this.pageMargin}px`;this.sendNotification(`${this.$t("bookreader.cycling_page_margin")}: ${t}`)}},cyclePageLayout(){if(this.continuousReader)return;const e=Object.values(ue),t=(e.indexOf(this.settings.pageLayout)+1)%e.length;this.pageLayout=e[t];const i=this.$i18n.t(this.pageLayout);this.sendNotification(`${this.$t("bookreader.cycling_page_layout")}: ${i}`)},toggleToolbars(){this.showToolbars=!this.showToolbars},toggleExplorer(){this.showExplorer=!this.showExplorer},toggleSettings(){this.showSettings=!this.showSettings},toggleHelp(){this.showHelp=!this.showHelp},closeDialog(){this.showExplorer?this.showExplorer=!1:this.showSettings?this.showSettings=!1:this.showToolbars?this.showToolbars=!1:this.closeBook()},sendNotificationReadingDirection(e){this.notificationReadingDirection.fromMetadata=e,this.notificationReadingDirection.enabled=!0},sendNotification(e,t=4e3){this.notification.timeout=t,this.notification.message=e,this.notification.enabled=!0},markProgress:(0,S.debounce)((function(e){this.incognito||this.$komgaBooks.updateReadProgress(this.bookId,{page:e})}),50),downloadCurrentPage(){new(Fe())({url:this.currentPage.url,filename:`${this.book.name}-${this.currentPage.number}.${this.currentPage.fileName.split(".").pop()}`,withCredentials:!0,forceDesktopMode:!0})},async setCurrentPageAsPoster(e){const t=await(0,Q.W)(this.currentPage.url,"poster","image/jpeg",{credentials:"include"}),i=await z(t);switch(e){case Ve.ll.BOOK:await this.$komgaBooks.uploadThumbnail(this.book.id,i,!0),this.sendNotification(`${this.$t("bookreader.notification_poster_set_book")}`);break;case Ve.ll.SERIES:await this.$komgaSeries.uploadThumbnail(this.series.id,i,!0),this.sendNotification(`${this.$t("bookreader.notification_poster_set_series")}`);break;case Ve.ll.READLIST:await this.$komgaReadLists.uploadThumbnail(this.context.id,i,!0),this.sendNotification(`${this.$t("bookreader.notification_poster_set_readlist")}`);break}}}}),Ke=Ye,Xe=(0,H.A)(Ke,$,P,!1,null,"891f5a62",null),Ze=Xe.exports},6231:function(e,t,i){i.d(t,{A:function(){return c}});var s=i(54582),o=i(8177),n=i(78956),a=i(49274),r=i(81582),l=i(72006),c=(0,l.A)(n.A,(0,a.A)({onVisible:["init"]}),r.A).extend({name:"v-pagination",directives:{Resize:o.A},props:{circle:Boolean,disabled:Boolean,navigationColor:String,navigationTextColor:String,length:{type:Number,default:0,validator:e=>e%1===0},nextIcon:{type:String,default:"$next"},prevIcon:{type:String,default:"$prev"},totalVisible:[Number,String],value:{type:Number,default:0},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},wrapperAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.wrapper"}},data(){return{maxButtons:0,selected:null}},computed:{classes(){return{"v-pagination":!0,"v-pagination--circle":this.circle,"v-pagination--disabled":this.disabled,...this.themeClasses}},items(){const e=parseInt(this.totalVisible,10);if(0===e||isNaN(this.length)||this.length>Number.MAX_SAFE_INTEGER)return[];const t=Math.min(Math.max(0,e)||this.length,Math.max(0,this.maxButtons)||this.length,this.length);if(this.length<=t)return this.range(1,this.length);const i=t%2===0?1:0,s=Math.floor(t/2),o=this.length-s+1+i;if(this.value>s&&this.value<o){const e=1,t=this.length,o=this.value-s+2,n=this.value+s-2-i,a=o-1===e+1?2:"...",r=n+1===t-1?n+1:"...";return[1,a,...this.range(o,n),r,this.length]}if(this.value===s){const e=this.value+s-1-i;return[...this.range(1,e),"...",this.length]}if(this.value===o){const e=this.value-s+1;return[1,"...",...this.range(e,this.length)]}return[...this.range(1,s),"...",...this.range(o,this.length)]}},watch:{value(){this.init()}},beforeMount(){this.init()},methods:{init(){this.selected=null,this.onResize(),this.$nextTick(this.onResize),setTimeout((()=>this.selected=this.value),100)},onResize(){const e=this.$el&&this.$el.parentElement?this.$el.parentElement.clientWidth:window.innerWidth;this.maxButtons=Math.floor((e-96)/42)},next(e){e.preventDefault(),this.$emit("input",this.value+1),this.$emit("next")},previous(e){e.preventDefault(),this.$emit("input",this.value-1),this.$emit("previous")},range(e,t){const i=[];e=e>0?e:1;for(let s=e;s<=t;s++)i.push(s);return i},genIcon(e,t,i,o,n){return e("li",[e("button",this.setBackgroundColor(this.navigationColor,{staticClass:"v-pagination__navigation",class:{"v-pagination__navigation--disabled":i},attrs:{disabled:i,type:"button","aria-label":n},on:i?{}:{click:o}}),[e(s.A,{props:{color:this.navigationTextColor}},[t])])])},genItem(e,t){const i=t===this.value&&(this.color||"primary"),s=t===this.value,o=s?this.currentPageAriaLabel:this.pageAriaLabel;return e("button",this.setBackgroundColor(i,{staticClass:"v-pagination__item",class:{"v-pagination__item--active":t===this.value},attrs:{type:"button","aria-current":s,"aria-label":this.$vuetify.lang.t(o,t)},on:{click:()=>this.$emit("input",t)}}),[t.toString()])},genItems(e){return this.items.map(((t,i)=>e("li",{key:i},[isNaN(Number(t))?e("span",{class:"v-pagination__more"},[t.toString()]):this.genItem(e,t)])))},genList(e,t){return e("ul",{directives:[{modifiers:{quiet:!0},name:"resize",value:this.onResize}],class:this.classes},t)}},render(e){const t=[this.genIcon(e,this.$vuetify.rtl?this.nextIcon:this.prevIcon,this.value<=1,this.previous,this.$vuetify.lang.t(this.previousAriaLabel)),this.genItems(e),this.genIcon(e,this.$vuetify.rtl?this.prevIcon:this.nextIcon,this.value>=this.length,this.next,this.$vuetify.lang.t(this.nextAriaLabel))];return e("nav",{attrs:{role:"navigation","aria-label":this.$vuetify.lang.t(this.wrapperAriaLabel)}},[this.genList(e,t)])}})},88172:function(e,t,i){function s(e,t,i){const{self:s=!1}=t.modifiers||{},o=t.value,n="object"===typeof o&&o.options||{passive:!0},a="function"===typeof o||"handleEvent"in o?o:o.handler,r=s?e:t.arg?document.querySelector(t.arg):window;r&&(r.addEventListener("scroll",a,n),e._onScroll=Object(e._onScroll),e._onScroll[i.context._uid]={handler:a,options:n,target:s?void 0:r})}function o(e,t,i){var s;if(!(null===(s=e._onScroll)||void 0===s?void 0:s[i.context._uid]))return;const{handler:o,options:n,target:a=e}=e._onScroll[i.context._uid];a.removeEventListener("scroll",o,n),delete e._onScroll[i.context._uid]}i.d(t,{O:function(){return n}});const n={inserted:s,unbind:o};t.A=n}}]);
//# sourceMappingURL=read-book.1304a03c.js.map