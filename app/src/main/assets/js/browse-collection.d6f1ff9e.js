"use strict";(self["webpackChunkkomga_webui"]=self["webpackChunkkomga_webui"]||[]).push([[5746],{45234:function(e,t,i){i.r(t),i.d(t,{default:function(){return U}});var s=i(73847),l=i(15137),a=i(70793),r=i(16684),o=i(6231),n=i(80700),c=i(40005),d=i(26702),h=i(84551),u=function(){var e=this,t=e._self._c;e._self._setupProxy;return e.collection?t("div",[e.editElements||0!==e.selectedSeries.length?e._e():t("toolbar-sticky",[e.collection?t("collection-actions-menu",{attrs:{collection:e.collection}}):e._e(),e.collection?t(d.sw,[t("span",[e._v(e._s(e.collection.name))]),t(l.A,{staticClass:"mx-4",attrs:{label:""}},[t("span",{staticStyle:{"font-size":"1.1rem"}},[e._v(e._s(e.totalElements))])]),e.collection.ordered?t("span",{staticClass:"font-italic text-overline"},[e._v("("+e._s(e.$t("browse_collection.manual_ordering"))+")")]):e._e()],1):e._e(),t(c.A),e.isAdmin?t(s.A,{attrs:{icon:""},on:{click:e.startEditElements}},[t(h.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(r.A,e._g({},i),[e._v("mdi-playlist-edit")])]}}],null,!1,1014130452)},[t("span",[e._v(e._s(e.$t("browse_collection.edit_elements")))])])],1):e._e(),e.isAdmin?t(s.A,{attrs:{icon:""},on:{click:e.editCollection}},[t(h.A,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t(r.A,e._g({},i),[e._v("mdi-pencil")])]}}],null,!1,1783139550)},[t("span",[e._v(e._s(e.$t("browse_collection.edit_collection")))])])],1):e._e(),t("page-size-select",{model:{value:e.pageSize,callback:function(t){e.pageSize=t},expression:"pageSize"}}),t(s.A,{attrs:{icon:""},on:{click:function(t){e.drawer=!e.drawer}}},[t(r.A,{attrs:{color:e.filterActive?"secondary":""}},[e._v("mdi-filter-variant")])],1)],1),t("multi-select-bar",{attrs:{kind:"series",oneshots:e.selectedOneshots,"show-select-all":""},on:{"unselect-all":function(t){e.selectedSeries=[]},"select-all":function(t){e.selectedSeries=e.series},"mark-read":e.markSelectedRead,"mark-unread":e.markSelectedUnread,"add-to-collection":e.addToCollection,"add-to-readlist":e.addToReadList,edit:e.editMultipleSeries,delete:e.deleteSeries},model:{value:e.selectedSeries,callback:function(t){e.selectedSeries=t},expression:"selectedSeries"}}),t(n.Yt,{attrs:{"hide-on-leave":""}},[e.editElements?t("toolbar-sticky",{attrs:{elevation:5,color:"base"}},[t(s.A,{attrs:{icon:""},on:{click:e.cancelEditElements}},[t(r.A,[e._v("mdi-close")])],1),t(s.A,{attrs:{icon:"",color:"primary",disabled:0===e.series.length},on:{click:e.doEditElements}},[t(r.A,[e._v("mdi-check")])],1)],1):e._e()],1),t("filter-drawer",{attrs:{"clear-button":e.filterActive},on:{clear:e.resetFilters},scopedSlots:e._u([{key:"default",fn:function(){return[t("filter-list",{attrs:{"filters-options":e.filterOptionsList,"filters-active":e.filters},on:{"update:filtersActive":function(t){e.filters=t},"update:filters-active":function(t){e.filters=t}}})]},proxy:!0},{key:"filter",fn:function(){return[t("filter-panels",{attrs:{"filters-options":e.filterOptionsPanel,"filters-active":e.filters},on:{"update:filtersActive":function(t){e.filters=t},"update:filters-active":function(t){e.filters=t}}})]},proxy:!0}],null,!1,457844017),model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}}),t(a.A,{attrs:{fluid:""}},[0===e.totalPages?t("empty-state",{attrs:{title:e.$t("common.filter_no_matches"),"sub-title":e.$t("common.use_filter_panel_to_change_filter"),icon:"mdi-book-multiple","icon-color":"secondary"}},[t(s.A,{on:{click:e.resetFilters}},[e._v(e._s(e.$t("common.reset_filters")))])],1):[e.totalPages>1?t(o.A,{attrs:{"total-visible":e.paginationVisible,length:e.totalPages},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e(),t("item-browser",{attrs:{items:e.series,selected:e.selectedSeries,"edit-function":e.isAdmin?e.editSingleSeries:void 0,draggable:e.editElements&&e.collection.ordered,deletable:e.editElements},on:{"update:items":function(t){e.series=t},"update:selected":function(t){e.selectedSeries=t}}}),e.totalPages>1?t(o.A,{attrs:{"total-visible":e.paginationVisible,length:e.totalPages},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e()]],2)],1):e._e()},g=[],p=(i(14602),i(28743),i(62554),i(28738)),f=i(10734),m=i(72448),v=i(52846),y=i(85471),S=i(78892),$=i(67036),b=i(79957),w=i(41834),k=i(71933),A=i(49865),E=i(97782),O=i(85894),_=i(1324),C=i(41272),R=i(2543),P=i(96982),I=i(13044),L=i(4395),q=i(19447),D=y.Ay.extend({name:"BrowseCollection",components:{PageSizeSelect:L.A,ToolbarSticky:m.A,ItemBrowser:f.A,CollectionActionsMenu:p.A,MultiSelectBar:S.A,FilterDrawer:A.A,FilterPanels:E.A,FilterList:O.A,EmptyState:_.A},data:function(){return{collection:void 0,series:[],seriesCopy:[],selectedSeries:[],page:1,pageSize:20,unpaged:!1,totalPages:1,totalElements:null,editElements:!1,filters:{},filterUnwatch:null,pageUnwatch:null,pageSizeUnwatch:null,drawer:!1,filterOptions:{library:[],genre:[],tag:[],publisher:[],language:[],ageRating:[],releaseDate:[]}}},props:{collectionId:{type:String,required:!0}},created(){this.$eventHub.$on(v.Gx,this.collectionChanged),this.$eventHub.$on(v.HS,this.collectionDeleted),this.$eventHub.$on(v.P,this.seriesChanged),this.$eventHub.$on(v.Mi,this.seriesChanged),this.$eventHub.$on(v.$V,this.readProgressChanged),this.$eventHub.$on(v.sn,this.readProgressChanged)},beforeDestroy(){this.$eventHub.$off(v.Gx,this.collectionChanged),this.$eventHub.$off(v.HS,this.collectionDeleted),this.$eventHub.$off(v.P,this.seriesChanged),this.$eventHub.$off(v.Mi,this.seriesChanged),this.$eventHub.$off(v.$V,this.readProgressChanged),this.$eventHub.$off(v.sn,this.readProgressChanged)},async mounted(){this.pageSize=this.$store.state.persistedState.browsingPageSize||this.pageSize,await this.resetParams(this.$route,this.collectionId),this.$route.query.page&&(this.page=Number(this.$route.query.page)),this.$route.query.pageSize&&(this.pageSize=Number(this.$route.query.pageSize)),this.loadCollection(this.collectionId),this.setWatches()},async beforeRouteUpdate(e,t,i){e.params.collectionId!==t.params.collectionId&&(this.unsetWatches(),await this.resetParams(this.$route,e.params.collectionId),this.page=1,this.totalPages=1,this.totalElements=null,this.series=[],this.editElements=!1,this.loadCollection(e.params.collectionId),this.setWatches()),i()},computed:{paginationVisible(){switch(this.$vuetify.breakpoint.name){case"xs":return 5;case"sm":case"md":return 10;case"lg":case"xl":default:return 15}},filterOptionsList(){return{readStatus:{values:[{name:this.$i18n.t("filter.unread").toString(),value:b.RJ.UNREAD},{name:this.$t("filter.in_progress").toString(),value:b.RJ.IN_PROGRESS},{name:this.$t("filter.read").toString(),value:b.RJ.READ}]},complete:{values:[{name:this.$t("filter.complete").toString(),value:"true",nValue:"false"}]}}},filterOptionsPanel(){const e={library:{name:this.$t("filter.library").toString(),values:this.filterOptions.library},status:{name:this.$t("filter.status").toString(),values:(0,w.q)()},genre:{name:this.$t("filter.genre").toString(),values:this.filterOptions.genre},tag:{name:this.$t("filter.tag").toString(),values:this.filterOptions.tag},publisher:{name:this.$t("filter.publisher").toString(),values:this.filterOptions.publisher},language:{name:this.$t("filter.language").toString(),values:this.filterOptions.language},ageRating:{name:this.$t("filter.age_rating").toString(),values:this.filterOptions.ageRating.map((e=>({name:"None"===e.value?this.$t("filter.age_rating_none").toString():e.name,value:e.value})))},releaseDate:{name:this.$t("filter.release_date").toString(),values:this.filterOptions.releaseDate}};return C.B.forEach((t=>{e[t]={name:this.$t(`author_roles.${t}`).toString(),search:async e=>(await this.$komgaReferential.getAuthors(e,t,void 0,this.collectionId)).content.map((e=>e.name))}})),e},isAdmin(){return this.$store.getters.meAdmin},filterActive(){return Object.keys(this.filters).some((e=>0!==this.filters[e].length))},selectedOneshots(){return this.selectedSeries.every((e=>e.oneshot))}},methods:{resetFilters(){this.drawer=!1;for(const e in this.filters)this.$set(this.filters,e,[]);this.$store.commit("setCollectionFilter",{id:this.collectionId,filter:this.filters}),this.updateRouteAndReload()},async resetParams(e,t){this.$set(this.filterOptions,"library",this.$store.state.komgaLibraries.libraries.map((e=>({name:e.name,value:e.id}))));const[i,s,l,a,r,o]=await Promise.all([this.$komgaReferential.getGenres(void 0,t),this.$komgaReferential.getSeriesAndBookTags(void 0,t),this.$komgaReferential.getPublishers(void 0,t),this.$komgaReferential.getLanguages(void 0,t),this.$komgaReferential.getAgeRatings(void 0,t),this.$komgaReferential.getSeriesReleaseDates(void 0,t)]);let n;this.$set(this.filterOptions,"genre",(0,k.Un)(i)),this.$set(this.filterOptions,"tag",(0,k.Un)(s)),this.$set(this.filterOptions,"publisher",(0,k.Un)(l)),this.$set(this.filterOptions,"language",a),this.$set(this.filterOptions,"ageRating",(0,k.Un)(r)),this.$set(this.filterOptions,"releaseDate",(0,k.Un)(o)),e.query.status||e.query.readStatus||e.query.genre||e.query.tag||e.query.language||e.query.ageRating||e.query.library||e.query.publisher||C.B.some((t=>t in e.query))||e.query.complete?(n={status:e.query.status||[],readStatus:e.query.readStatus||[],library:e.query.library||[],genre:e.query.genre||[],tag:e.query.tag||[],publisher:e.query.publisher||[],language:e.query.language||[],ageRating:e.query.ageRating||[],releaseDate:e.query.releaseDate||[],complete:e.query.complete||[]},C.B.forEach((t=>{n[t]=e.query[t]||[]}))):n=this.$store.getters.getCollectionFilter(e.params.collectionId)||{},this.filters=this.validateFilters(n)},validateFilters(e){var t,i,s,l,a,r,o,n,c,d;const h={status:(null===(t=e.status)||void 0===t?void 0:t.filter((e=>Object.keys(w.m).includes(e))))||[],readStatus:(null===(i=e.readStatus)||void 0===i?void 0:i.filter((e=>Object.keys(b.RJ).includes(e))))||[],library:(null===(s=e.library)||void 0===s?void 0:s.filter((e=>this.filterOptions.library.map((e=>e.value)).includes(e))))||[],genre:(null===(l=e.genre)||void 0===l?void 0:l.filter((e=>this.filterOptions.genre.map((e=>e.value)).includes(e))))||[],tag:(null===(a=e.tag)||void 0===a?void 0:a.filter((e=>this.filterOptions.tag.map((e=>e.value)).includes(e))))||[],publisher:(null===(r=e.publisher)||void 0===r?void 0:r.filter((e=>this.filterOptions.publisher.map((e=>e.value)).includes(e))))||[],language:(null===(o=e.language)||void 0===o?void 0:o.filter((e=>this.filterOptions.language.map((e=>e.value)).includes(e))))||[],ageRating:(null===(n=e.ageRating)||void 0===n?void 0:n.filter((e=>this.filterOptions.ageRating.map((e=>e.value)).includes(e))))||[],releaseDate:(null===(c=e.releaseDate)||void 0===c?void 0:c.filter((e=>this.filterOptions.releaseDate.map((e=>e.value)).includes(e))))||[],complete:(null===(d=e.complete)||void 0===d?void 0:d.filter((e=>"true"===e||"false"===e)))||[]};return C.B.forEach((t=>{h[t]=e[t]||[]})),h},setWatches(){this.filterUnwatch=this.$watch("filters",(e=>{this.$store.commit("setCollectionFilter",{id:this.collectionId,filter:e}),this.updateRouteAndReload()})),this.pageSizeUnwatch=this.$watch("pageSize",(e=>{this.$store.commit("setBrowsingPageSize",e),this.updateRouteAndReload()})),this.pageUnwatch=this.$watch("page",(e=>{this.updateRoute(),this.loadPage(this.collectionId,e)}))},unsetWatches(){this.filterUnwatch(),this.pageUnwatch(),this.pageSizeUnwatch()},collectionChanged(e){e.collectionId===this.collectionId&&this.loadCollection(this.collectionId)},collectionDeleted(e){e.collectionId===this.collectionId&&this.$router.push({name:"browse-collections",params:{libraryId:$._}})},updateRouteAndReload(){this.unsetWatches(),this.page=1,this.updateRoute(),this.loadPage(this.collectionId,this.page),this.setWatches()},async loadPage(e,t){this.selectedSeries=[];const i={page:t-1,size:this.pageSize,unpaged:this.unpaged};let s=[];C.B.forEach((e=>{e in this.filters&&this.filters[e].forEach((t=>s.push({name:t,role:e})))}));const l=(0,P.C)(this.filters.complete),a=await this.$komgaCollections.getSeries(e,i,this.filters.library,this.filters.status,this.filters.readStatus,this.filters.genre,this.filters.tag,this.filters.language,this.filters.publisher,this.filters.ageRating,this.filters.releaseDate,s,l);this.totalPages=a.totalPages,this.totalElements=a.totalElements,this.series=a.content,this.series.forEach((t=>t.context={origin:I.E.COLLECTION,id:e})),this.seriesCopy=[...this.series],this.selectedSeries=[]},reloadPage:(0,R.throttle)((function(){this.loadPage(this.collectionId,this.page)}),1e3),async loadCollection(e){this.$komgaCollections.getOneCollection(e).then((e=>{this.collection=e,document.title=`Komga - ${e.name}`})),await this.loadPage(e,this.page)},updateRoute(){const e={name:this.$route.name,params:{collectionId:this.$route.params.collectionId},query:{page:`${this.page}`,pageSize:`${this.pageSize}`}};(0,k.Bp)(this.filters,e.query),this.$router.replace(e).catch((e=>{}))},async editSingleSeries(e){if(e.oneshot){const t=(await this.$komgaBooks.getBooksList({condition:new q.kq(new q.Tr(e.id))})).content[0];this.$store.dispatch("dialogUpdateOneshots",{series:e,book:t})}else this.$store.dispatch("dialogUpdateSeries",e)},async editMultipleSeries(){if(this.selectedSeries.every((e=>e.oneshot))){const e=await Promise.all(this.selectedSeries.map((e=>this.$komgaBooks.getBooksList({condition:new q.kq(new q.Tr(e.id))})))),t=this.selectedSeries.map(((t,i)=>({series:t,book:e[i].content[0]})));this.$store.dispatch("dialogUpdateOneshots",t)}else this.$store.dispatch("dialogUpdateSeries",this.selectedSeries)},deleteSeries(){this.$store.dispatch("dialogDeleteSeries",this.selectedSeries)},async markSelectedRead(){await Promise.all(this.selectedSeries.map((e=>this.$komgaSeries.markAsRead(e.id)))),this.selectedSeries=[]},async markSelectedUnread(){await Promise.all(this.selectedSeries.map((e=>this.$komgaSeries.markAsUnread(e.id)))),this.selectedSeries=[]},addToCollection(){this.$store.dispatch("dialogAddSeriesToCollection",this.selectedSeries.map((e=>e.id)))},async addToReadList(){const e=this.selectedSeries.map((e=>new q.kq(new q.Tr(e.id)))),t=await this.$komgaBooks.getBooksList({condition:new q.a4(e)},{unpaged:!0});this.$store.dispatch("dialogAddBooksToReadList",t.content.map((e=>e.id)))},async startEditElements(){this.filters={},this.unpaged=!0,await this.reloadPage(),this.editElements=!0},cancelEditElements(){this.editElements=!1,this.series=[...this.seriesCopy],this.unpaged=!1,this.reloadPage()},doEditElements(){this.editElements=!1;const e={seriesIds:this.series.map((e=>e.id))};this.$komgaCollections.patchCollection(this.collectionId,e),this.unpaged=!1,this.reloadPage()},editCollection(){this.$store.dispatch("dialogEditCollection",this.collection)},seriesChanged(e){this.series.some((t=>t.id===e.seriesId))&&this.reloadPage()},readProgressChanged(e){this.series.some((t=>t.id===e.seriesId))&&this.reloadPage()}}}),N=D,x=i(81656),T=(0,x.A)(N,u,g,!1,null,null,null),U=T.exports},96982:function(e,t,i){i.d(t,{C:function(){return a},k:function(){return l}});i(68329);const s=["asc","desc"];function l(e,t){let i=null;if(e){const l=e.split(",");2===l.length&&t.map((e=>e.key)).includes(l[0])&&s.includes(l[1])&&(i={key:l[0],order:l[1]})}return i}function a(e){if(e&&0!==e.length)return"true"===e[0].trim().toLowerCase()||"false"!==e[0].trim().toLowerCase()&&void 0}},13044:function(e,t,i){var s;i.d(t,{E:function(){return s}}),function(e){e["SERIES"]="SERIES",e["READLIST"]="READLIST",e["LIBRARY"]="LIBRARY",e["COLLECTION"]="COLLECTION"}(s||(s={}))},41834:function(e,t,i){i.d(t,{m:function(){return s},q:function(){return a}});var s,l=i(80061);function a(){return Object.values(s).map((e=>({name:l.A.t(`enums.series_status.${e}`),value:e})))}(function(e){e["ENDED"]="ENDED",e["ONGOING"]="ONGOING",e["ABANDONED"]="ABANDONED",e["HIATUS"]="HIATUS"})(s||(s={}))},89233:function(e,t,i){var s=i(12071).PROPER,l=i(92074),a=i(55073),r="​᠎";e.exports=function(e){return l((function(){return!!a[e]()||r[e]()!==r||s&&a[e].name!==e}))}},69163:function(e,t,i){var s=i(30281),l=i(71229),a=i(95362),r=i(55073),o=s("".replace),n=RegExp("^["+r+"]+"),c=RegExp("(^|[^"+r+"])["+r+"]+$"),d=function(e){return function(t){var i=a(l(t));return 1&e&&(i=o(i,n,"")),2&e&&(i=o(i,c,"$1")),i}};e.exports={start:d(1),end:d(2),trim:d(3)}},55073:function(e){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},68329:function(e,t,i){var s=i(51605),l=i(69163).trim,a=i(89233);s({target:"String",proto:!0,forced:a("trim")},{trim:function(){return l(this)}})},90826:function(e,t,i){i.d(t,{A:function(){return o}});var s=i(32240),l=s.A,a=i(69463),r=i(85471),o=r.Ay.extend().extend({name:"overlayable",props:{hideOverlay:Boolean,overlayColor:String,overlayOpacity:[Number,String]},data(){return{animationFrame:0,overlay:null}},watch:{hideOverlay(e){this.isActive&&(e?this.removeOverlay():this.genOverlay())}},beforeDestroy(){this.removeOverlay()},methods:{createOverlay(){const e=new l({propsData:{absolute:this.absolute,value:!1,color:this.overlayColor,opacity:this.overlayOpacity}});e.$mount();const t=this.absolute?this.$el.parentNode:document.querySelector("[data-app]");t&&t.insertBefore(e.$el,t.firstChild),this.overlay=e},genOverlay(){if(this.hideScroll(),!this.hideOverlay)return this.overlay||this.createOverlay(),this.animationFrame=requestAnimationFrame((()=>{this.overlay&&(void 0!==this.activeZIndex?this.overlay.zIndex=String(this.activeZIndex-1):this.$el&&(this.overlay.zIndex=(0,a.fl)(this.$el)),this.overlay.value=!0)})),!0},removeOverlay(e=!0){this.overlay&&((0,a.d7)(this.overlay.$el,"transitionend",(()=>{this.overlay&&this.overlay.$el&&this.overlay.$el.parentNode&&!this.overlay.value&&!this.isActive&&(this.overlay.$el.parentNode.removeChild(this.overlay.$el),this.overlay.$destroy(),this.overlay=null)})),cancelAnimationFrame(this.animationFrame),this.overlay.value=!1),e&&this.showScroll()},scrollListener(e){if("key"in e){if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)||e.target.isContentEditable)return;const t=[a.uP.up,a.uP.pageup],i=[a.uP.down,a.uP.pagedown];if(t.includes(e.keyCode))e.deltaY=-1;else{if(!i.includes(e.keyCode))return;e.deltaY=1}}(e.target===this.overlay||"keydown"!==e.type&&e.target===document.body||this.checkPath(e))&&e.preventDefault()},hasScrollbar(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const t=window.getComputedStyle(e);return(["auto","scroll"].includes(t.overflowY)||"SELECT"===e.tagName)&&e.scrollHeight>e.clientHeight||["auto","scroll"].includes(t.overflowX)&&e.scrollWidth>e.clientWidth},shouldScroll(e,t){if(e.hasAttribute("data-app"))return!1;const i=t.shiftKey||t.deltaX?"x":"y",s="y"===i?t.deltaY:t.deltaX||t.deltaY;let l,a;"y"===i?(l=0===e.scrollTop,a=e.scrollTop+e.clientHeight===e.scrollHeight):(l=0===e.scrollLeft,a=e.scrollLeft+e.clientWidth===e.scrollWidth);const r=s<0,o=s>0;return!(l||!r)||(!(a||!o)||!(!l&&!a||!e.parentNode)&&this.shouldScroll(e.parentNode,t))},isInside(e,t){return e===t||null!==e&&e!==document.body&&this.isInside(e.parentNode,t)},checkPath(e){const t=(0,a.K9)(e);if("keydown"===e.type&&t[0]===document.body){const t=this.$refs.dialog,i=window.getSelection().anchorNode;return!(t&&this.hasScrollbar(t)&&this.isInside(i,t))||!this.shouldScroll(t,e)}for(let i=0;i<t.length;i++){const s=t[i];if(s===document)return!0;if(s===document.documentElement)return!0;if(s===this.$refs.content)return!0;if(this.hasScrollbar(s))return!this.shouldScroll(s,e)}return!0},hideScroll(){this.$vuetify.breakpoint.smAndDown?document.documentElement.classList.add("overflow-y-hidden"):((0,a.P4)(window,"wheel",this.scrollListener,{passive:!1}),window.addEventListener("keydown",this.scrollListener))},showScroll(){document.documentElement.classList.remove("overflow-y-hidden"),window.removeEventListener("wheel",this.scrollListener),window.removeEventListener("keydown",this.scrollListener)}}})}}]);
//# sourceMappingURL=browse-collection.d6f1ff9e.js.map